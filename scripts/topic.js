(()=>{var d=class{constructor(){this.overlayId="topic-overlay",this.contentId="topic-content",this.loaderId="topic-loader",this.topicBodyId="topic-body",this.topicActionsId="topic-actions",this.markTopicDoneId="mark-topic-done",this.markTopicPendingId="mark-topic-pending",this.closeTopicId="close-topic",this.activeRoadmapId=null,this.activeTopicId=null,this.handleTopicClick=this.handleTopicClick.bind(this),this.close=this.close.bind(this),this.resetDOM=this.resetDOM.bind(this),this.populate=this.populate.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.markAsDone=this.markAsDone.bind(this),this.markAsPending=this.markAsPending.bind(this),this.queryRoadmapElementsByTopicId=this.queryRoadmapElementsByTopicId.bind(this),this.init=this.init.bind(this)}get loaderEl(){return document.getElementById(this.loaderId)}get markTopicDoneEl(){return document.getElementById(this.markTopicDoneId)}get markTopicPendingEl(){return document.getElementById(this.markTopicPendingId)}get topicActionsEl(){return document.getElementById(this.topicActionsId)}get contentEl(){return document.getElementById(this.contentId)}get overlayEl(){return document.getElementById(this.overlayId)}resetDOM(t=!1){t?this.overlayEl.classList.add("hidden"):this.overlayEl.classList.remove("hidden"),this.loaderEl.classList.remove("hidden"),this.topicActionsEl.classList.add("hidden"),this.contentEl.replaceChildren("")}close(){this.resetDOM(!0),this.activeRoadmapId=null,this.activeTopicId=null}populate(t){this.contentEl.replaceChildren(t),this.loaderEl.classList.add("hidden"),this.topicActionsEl.classList.remove("hidden");let e=(this.activeTopicId||"").replace(/^\d+-/,"");localStorage.getItem(e)==="done"?(this.markTopicDoneEl.classList.add("hidden"),this.markTopicPendingEl.classList.remove("hidden")):(this.markTopicDoneEl.classList.remove("hidden"),this.markTopicPendingEl.classList.add("hidden"))}fetchTopicHtml(t,e){let i=e.replace(/^\d+-/,"").replaceAll(/:/g,"/"),s=`/${t}/${i}/`;return fetch(s).then(o=>o.text()).then(o=>new DOMParser().parseFromString(o,"text/html").getElementById("main-content"))}handleTopicClick(t){let{roadmapId:e,topicId:i}=t.detail;if(!i||!e){console.log("Missing topic or roadmap: ",t.detail);return}if(this.activeRoadmapId=e,this.activeTopicId=i,/^ext_link/.test(i)){window.open(`https://${i.replace("ext_link:","")}`);return}this.resetDOM(),this.fetchTopicHtml(e,i).then(s=>{this.populate(s)}).catch(s=>{console.error(s),this.populate("Error loading the content!")})}queryRoadmapElementsByTopicId(t){let e=document.querySelectorAll(`[data-group-id$="-${t}"]`),i=[];return e.forEach(s=>{let o=s?.dataset?.groupId||"";new RegExp(`^\\d+-${t}$`).test(o)&&i.push(s)}),i}markAsDone(t){let e=t.replace(/^\d+-/,"");localStorage.setItem(e,"done"),this.queryRoadmapElementsByTopicId(e).forEach(i=>{i?.classList?.add("done")})}markAsPending(t){let e=t.replace(/^\d+-/,"");localStorage.removeItem(e),this.queryRoadmapElementsByTopicId(e).forEach(i=>{i?.classList?.remove("done")})}handleOverlayClick(t){if(!t.target.closest(`#${this.topicBodyId}`)){this.close();return}(t.target.id===this.markTopicDoneId||t.target.closest(`#${this.markTopicDoneId}`))&&(this.markAsDone(this.activeTopicId),this.close()),(t.target.id===this.markTopicPendingId||t.target.closest(`#${this.markTopicPendingId}`))&&(this.markAsPending(this.activeTopicId),this.close()),(t.target.id===this.closeTopicId||t.target.closest(`#${this.closeTopicId}`))&&this.close()}init(){window.addEventListener("topic.click",this.handleTopicClick),window.addEventListener("click",this.handleOverlayClick),window.addEventListener("keydown",t=>{t.key.toLowerCase()==="escape"&&this.close()})}};})();
//# sourceMappingURL=topic.js.map
