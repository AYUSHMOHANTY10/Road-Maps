(()=>{var n=class{constructor(){this.overlayId="topic-overlay",this.contentId="topic-content",this.loaderId="topic-loader",this.topicBodyId="topic-body",this.topicActionsId="topic-actions",this.markTopicDoneId="mark-topic-done",this.activeRoadmapId=null,this.activeTopicId=null,this.handleTopicClick=this.handleTopicClick.bind(this),this.close=this.close.bind(this),this.resetDOM=this.resetDOM.bind(this),this.populate=this.populate.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.markAsDone=this.markAsDone.bind(this),this.queryRoadmapElementsByTopicId=this.queryRoadmapElementsByTopicId.bind(this),this.init=this.init.bind(this)}get loaderEl(){return document.getElementById(this.loaderId)}get markTopicDoneEl(){return document.getElementById(this.markTopicDoneId)}get topicActionsEl(){return document.getElementById(this.topicActionsId)}get contentEl(){return document.getElementById(this.contentId)}get overlayEl(){return document.getElementById(this.overlayId)}resetDOM(t=!1){t?this.overlayEl.classList.add("hidden"):this.overlayEl.classList.remove("hidden"),this.loaderEl.classList.remove("hidden"),this.topicActionsEl.classList.add("hidden"),this.contentEl.replaceChildren("")}close(){this.resetDOM(!0),this.activeRoadmapId=null,this.activeTopicId=null}populate(t){this.contentEl.replaceChildren(t),this.loaderEl.classList.add("hidden"),this.topicActionsEl.classList.remove("hidden")}fetchTopicHtml(t,i){let e=i.replace(/^\d+-/,"").replaceAll(/:/g,"/"),o=`/${t}/${e}/`;return fetch(o).then(s=>s.text()).then(s=>new DOMParser().parseFromString(s,"text/html").getElementById("main-content"))}handleTopicClick(t){let{roadmapId:i,topicId:e}=t.detail;if(!e||!i){console.log("Missing topic or roadmap: ",t.detail);return}if(this.activeRoadmapId=i,this.activeTopicId=e,/^ext_link/.test(e)){window.open(`https://${e.replace("ext_link:","")}`);return}this.resetDOM(),this.fetchTopicHtml(i,e).then(o=>{this.populate(o)}).catch(o=>{console.error(o),this.populate("Error loading the content!")})}queryRoadmapElementsByTopicId(t){let i=document.querySelectorAll(`[data-group-id$="-${t}"]`),e=[];return i.forEach(o=>{let s=o?.dataset?.groupId||"";new RegExp(`^\\d+-${t}$`).test(s)&&e.push(o)}),e}markAsDone(t){let i=t.replace(/^\d+-/,"");localStorage.setItem(i,"done"),this.queryRoadmapElementsByTopicId(i).forEach(e=>{e?.classList?.add("done")})}handleOverlayClick(t){if(!t.target.closest(`#${this.topicBodyId}`)){this.close();return}t.target.id===this.markTopicDoneId&&(this.markAsDone(this.activeTopicId),this.close())}init(){window.addEventListener("topic.click",this.handleTopicClick),window.addEventListener("click",this.handleOverlayClick),window.addEventListener("keydown",t=>{t.key.toLowerCase()==="escape"&&this.close()})}};})();
//# sourceMappingURL=topic.js.map
