{
  "version": 3,
  "sources": ["../../src/scripts/topic.js"],
  "sourcesContent": ["export class Topic {\n  constructor() {\n    this.overlayId = 'topic-overlay';\n    this.contentId = 'topic-content';\n    this.loaderId = 'topic-loader';\n    this.topicBodyId = 'topic-body';\n    this.topicActionsId = 'topic-actions';\n    this.markTopicDoneId = 'mark-topic-done';\n\n    this.activeRoadmapId = null;\n    this.activeTopicId = null;\n\n    this.handleTopicClick = this.handleTopicClick.bind(this);\n\n    this.close = this.close.bind(this);\n    this.resetDOM = this.resetDOM.bind(this);\n    this.populate = this.populate.bind(this);\n    this.handleOverlayClick = this.handleOverlayClick.bind(this);\n    this.markAsDone = this.markAsDone.bind(this);\n    this.queryRoadmapElementsByTopicId = this.queryRoadmapElementsByTopicId.bind(this);\n\n    this.init = this.init.bind(this);\n  }\n\n  get loaderEl() {\n    return document.getElementById(this.loaderId);\n  }\n\n  get markTopicDoneEl() {\n    return document.getElementById(this.markTopicDoneId);\n  }\n\n  get topicActionsEl() {\n    return document.getElementById(this.topicActionsId);\n  }\n\n  get contentEl() {\n    return document.getElementById(this.contentId);\n  }\n\n  get overlayEl() {\n    return document.getElementById(this.overlayId);\n  }\n\n  resetDOM(hideOverlay = false) {\n    if (hideOverlay) {\n      this.overlayEl.classList.add('hidden');\n    } else {\n      this.overlayEl.classList.remove('hidden');\n    }\n\n    this.loaderEl.classList.remove('hidden'); // Show loader\n    this.topicActionsEl.classList.add('hidden'); // Hide Actions\n    this.contentEl.replaceChildren(''); // Remove content\n  }\n\n  close() {\n    this.resetDOM(true);\n\n    this.activeRoadmapId = null;\n    this.activeTopicId = null;\n  }\n\n  /**\n   * @param {string | HTMLElement} html\n   */\n  populate(html) {\n    this.contentEl.replaceChildren(html);\n    this.loaderEl.classList.add('hidden');\n    this.topicActionsEl.classList.remove('hidden');\n  }\n\n  fetchTopicHtml(roadmapId, topicId) {\n    const topicPartial = topicId.replace(/^\\d+-/, '').replaceAll(/:/g, '/');\n    const fullUrl = `/${roadmapId}/${topicPartial}/`;\n\n    return fetch(fullUrl)\n      .then((res) => {\n        return res.text();\n      })\n      .then((topicHtml) => {\n        // It's full HTML with page body, head etc.\n        // We only need the inner HTML of the #main-content\n        const node = new DOMParser().parseFromString(topicHtml, 'text/html');\n\n        return node.getElementById('main-content');\n      });\n  }\n\n  handleTopicClick(e) {\n    const { roadmapId, topicId } = e.detail;\n    if (!topicId || !roadmapId) {\n      console.log('Missing topic or roadmap: ', e.detail);\n      return;\n    }\n\n    this.activeRoadmapId = roadmapId;\n    this.activeTopicId = topicId;\n\n    if (/^ext_link/.test(topicId)) {\n      window.open(`https://${topicId.replace('ext_link:', '')}`);\n      return;\n    }\n\n    this.resetDOM();\n    this.fetchTopicHtml(roadmapId, topicId)\n      .then((content) => {\n        this.populate(content);\n      })\n      .catch((e) => {\n        console.error(e);\n        this.populate('Error loading the content!');\n      });\n  }\n\n  queryRoadmapElementsByTopicId(topicId) {\n    const elements = document.querySelectorAll(`[data-group-id$=\"-${topicId}\"]`);\n    const matchingElements = [];\n\n    elements.forEach((element) => {\n      const foundGroupId = element?.dataset?.groupId || '';\n      const validGroupRegex = new RegExp(`^\\\\d+-${topicId}$`);\n\n      if (validGroupRegex.test(foundGroupId)) {\n        matchingElements.push(element);\n      }\n    });\n\n    return matchingElements;\n  }\n\n  markAsDone(topicId) {\n    const updatedTopicId = topicId.replace(/^\\d+-/, '');\n    localStorage.setItem(updatedTopicId, 'done');\n\n    this.queryRoadmapElementsByTopicId(updatedTopicId).forEach((item) => {\n      item?.classList?.add('done');\n    });\n  }\n\n  handleOverlayClick(e) {\n    const isClickedInsideTopic = e.target.closest(`#${this.topicBodyId}`);\n\n    if (!isClickedInsideTopic) {\n      this.close();\n      return;\n    }\n\n    const isClickedDone = e.target.id === this.markTopicDoneId;\n    if (isClickedDone) {\n      this.markAsDone(this.activeTopicId);\n      this.close();\n    }\n  }\n\n  init() {\n    window.addEventListener('topic.click', this.handleTopicClick);\n    window.addEventListener('click', this.handleOverlayClick);\n    window.addEventListener('keydown', (e) => {\n      if (e.key.toLowerCase() === 'escape') {\n        this.close();\n      }\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": ["Topic", "hideOverlay", "html", "roadmapId", "topicId", "topicPartial", "fullUrl", "res", "topicHtml", "e", "content", "elements", "matchingElements", "element", "foundGroupId", "updatedTopicId", "item"]
}
