{
  "version": 3,
  "sources": ["../../src/scripts/topic.js"],
  "sourcesContent": ["export class Topic {\n  constructor() {\n    this.overlayId = 'topic-overlay';\n    this.contentId = 'topic-content';\n    this.loaderId = 'topic-loader';\n    this.topicBodyId = 'topic-body';\n\n    this.handleTopicClick = this.handleTopicClick.bind(this);\n\n    this.close = this.close.bind(this);\n    this.loading = this.loading.bind(this);\n    this.populate = this.populate.bind(this);\n    this.handleOverlayClick = this.handleOverlayClick.bind(this);\n\n    this.init = this.init.bind(this);\n  }\n\n  get loaderEl() {\n    return document.getElementById(this.loaderId);\n  }\n\n  get contentEl() {\n    return document.getElementById(this.contentId);\n  }\n\n  get overlayEl() {\n    return document.getElementById(this.overlayId);\n  }\n\n  loading() {\n    this.loaderEl.classList.remove('hidden'); // Show loader\n    this.contentEl.replaceChildren(''); // Remove content\n    this.overlayEl.classList.remove('hidden'); // Show Overlay\n  }\n\n  close() {\n    this.overlayEl.classList.add('hidden'); // Hide Overlay\n    this.loaderEl.classList.remove('hidden'); // Show loader\n    this.contentEl.replaceChildren(''); // Remove content\n  }\n\n  /**\n   * @param {string | HTMLElement} html\n   */\n  populate(html) {\n    this.contentEl.replaceChildren(html);\n    this.loaderEl.classList.add('hidden');\n  }\n\n  fetchTopicHtml(roadmapId, topicId) {\n    const topicPartial = topicId.replace(/^\\d+-/, '').replaceAll(/:/g, '/');\n    const fullUrl = `/${roadmapId}/${topicPartial}/`;\n\n    return fetch(fullUrl)\n      .then((res) => {\n        return res.text();\n      })\n      .then((topicHtml) => {\n        // It's full HTML with page body, head etc.\n        // We only need the inner HTML of the #main-content\n        const node = new DOMParser().parseFromString(topicHtml, 'text/html');\n\n        return node.getElementById('main-content');\n      });\n  }\n\n  handleTopicClick(e) {\n    const { roadmapId, topicId } = e.detail;\n    if (!topicId || !roadmapId) {\n      console.log('Missing topic or roadmap: ', e.detail);\n      return;\n    }\n\n    if (/^ext_link/.test(topicId)) {\n      window.open(`https://${topicId.replace('ext_link:', '')}`);\n      return;\n    }\n\n    this.loading();\n    this.fetchTopicHtml(roadmapId, topicId)\n      .then((content) => {\n        this.populate(content);\n      })\n      .catch((e) => {\n        console.error(e);\n        this.populate('Error loading the content!');\n      });\n  }\n\n  handleOverlayClick(e) {\n    // Clicked inside the roadmap topic\n    if (e.target.closest(`#${this.topicBodyId}`)) {\n      return;\n    }\n\n    this.close();\n  }\n\n  init() {\n    window.addEventListener('topic.click', this.handleTopicClick);\n    window.addEventListener('click', this.handleOverlayClick);\n    window.addEventListener('keydown', (e) => {\n      if (e.key.toLowerCase() === 'escape') {\n        this.close();\n      }\n    });\n  }\n}\n"],
  "mappings": "MAAO,IAAMA,EAAN,KAAY,CACjB,aAAc,CACZ,KAAK,UAAY,gBACjB,KAAK,UAAY,gBACjB,KAAK,SAAW,eAChB,KAAK,YAAc,aAEnB,KAAK,iBAAmB,KAAK,iBAAiB,KAAK,IAAI,EAEvD,KAAK,MAAQ,KAAK,MAAM,KAAK,IAAI,EACjC,KAAK,QAAU,KAAK,QAAQ,KAAK,IAAI,EACrC,KAAK,SAAW,KAAK,SAAS,KAAK,IAAI,EACvC,KAAK,mBAAqB,KAAK,mBAAmB,KAAK,IAAI,EAE3D,KAAK,KAAO,KAAK,KAAK,KAAK,IAAI,CACjC,CAEA,IAAI,UAAW,CACb,OAAO,SAAS,eAAe,KAAK,QAAQ,CAC9C,CAEA,IAAI,WAAY,CACd,OAAO,SAAS,eAAe,KAAK,SAAS,CAC/C,CAEA,IAAI,WAAY,CACd,OAAO,SAAS,eAAe,KAAK,SAAS,CAC/C,CAEA,SAAU,CACR,KAAK,SAAS,UAAU,OAAO,QAAQ,EACvC,KAAK,UAAU,gBAAgB,EAAE,EACjC,KAAK,UAAU,UAAU,OAAO,QAAQ,CAC1C,CAEA,OAAQ,CACN,KAAK,UAAU,UAAU,IAAI,QAAQ,EACrC,KAAK,SAAS,UAAU,OAAO,QAAQ,EACvC,KAAK,UAAU,gBAAgB,EAAE,CACnC,CAKA,SAASC,EAAM,CACb,KAAK,UAAU,gBAAgBA,CAAI,EACnC,KAAK,SAAS,UAAU,IAAI,QAAQ,CACtC,CAEA,eAAeC,EAAWC,EAAS,CACjC,IAAMC,EAAeD,EAAQ,QAAQ,QAAS,EAAE,EAAE,WAAW,KAAM,GAAG,EAChEE,EAAU,IAAIH,KAAaE,KAEjC,OAAO,MAAMC,CAAO,EACjB,KAAMC,GACEA,EAAI,KAAK,CACjB,EACA,KAAMC,GAGQ,IAAI,UAAU,EAAE,gBAAgBA,EAAW,WAAW,EAEvD,eAAe,cAAc,CAC1C,CACL,CAEA,iBAAiBC,EAAG,CAClB,GAAM,CAAE,UAAAN,EAAW,QAAAC,CAAQ,EAAIK,EAAE,OACjC,GAAI,CAACL,GAAW,CAACD,EAAW,CAC1B,QAAQ,IAAI,6BAA8BM,EAAE,MAAM,EAClD,MACF,CAEA,GAAI,YAAY,KAAKL,CAAO,EAAG,CAC7B,OAAO,KAAK,WAAWA,EAAQ,QAAQ,YAAa,EAAE,GAAG,EACzD,MACF,CAEA,KAAK,QAAQ,EACb,KAAK,eAAeD,EAAWC,CAAO,EACnC,KAAMM,GAAY,CACjB,KAAK,SAASA,CAAO,CACvB,CAAC,EACA,MAAOD,GAAM,CACZ,QAAQ,MAAMA,CAAC,EACf,KAAK,SAAS,4BAA4B,CAC5C,CAAC,CACL,CAEA,mBAAmBA,EAAG,CAEhBA,EAAE,OAAO,QAAQ,IAAI,KAAK,aAAa,GAI3C,KAAK,MAAM,CACb,CAEA,MAAO,CACL,OAAO,iBAAiB,cAAe,KAAK,gBAAgB,EAC5D,OAAO,iBAAiB,QAAS,KAAK,kBAAkB,EACxD,OAAO,iBAAiB,UAAYA,GAAM,CACpCA,EAAE,IAAI,YAAY,IAAM,UAC1B,KAAK,MAAM,CAEf,CAAC,CACH,CACF",
  "names": ["Topic", "html", "roadmapId", "topicId", "topicPartial", "fullUrl", "res", "topicHtml", "e", "content"]
}
