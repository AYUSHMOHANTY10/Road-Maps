(()=>{function T(d){return(d||"").replace(/^\d+-/,"")}function R(d){let t=d>>16&255,e=d>>8&255,o=d&255;return`rgb(${t},${e},${o})`}function p(d,t={},e){let o=document.createElementNS("http://www.w3.org/2000/svg",d);for(let i in t)!t.hasOwnProperty(i)||o.setAttribute(i,t[i]);return e&&e.appendChild(o),o}var m=2.7,D=4,L=2,x={black:["#000"],gray:["#000","#333","#666","#999","#ccc","#ddd","#eee"],white:["#fff"],red:["#cf2a27","#ea9999","#eo6666","#cc0000","#990000","#660000"],orange:["#ff9900","#f9cb9c","#f6b26b","#e69138","#b45f06","#783f04"],yellow:["#ffff00","#ffe599","#ffd966","#f1c232","#bf9000","#7f6000"],green:["#009e0f","#b6d7a8","#93c47d","#6aa84f","#38761d","#274e13"],cyan:["#00ffff","#a2c4c9","#76a5af","#45818e","#134f5c","#0c343d"],blue:["#2b78e4","#9fc5f8","#6fa8dc","#597eaa","#085394","#073763"],purple:["#9900ff","#b4a7d6","#8e7cc3","#674ea7","#351c75","#20124d"],pink:["#ff00ff","#d5a6bd","#c27ba0","#a64d79","#741b47","#4c1130"]},k=class{constructor(t,e){this.svgRoot=t,this.fontFamily=e,this.canvasRenderingContext2D=document.createElement("canvas").getContext("2d")}render(t,e){let o=t.typeID;o in this?this[o](t,e):console.log(`'${o}' control type not implemented`)}parseColor(t,e){return t===void 0?`rgb(${e})`:R(t)}parseFontProperties(t){var e,o,i;return{style:(e=t.properties)!=null&&e.italic?"italic":"normal",weight:(o=t.properties)!=null&&o.bold?"bold":"normal",size:(i=t.properties)!=null&&i.size?t.properties.size+"px":"13px",family:this.fontFamily}}measureText(t,e){return this.canvasRenderingContext2D.font=e,this.canvasRenderingContext2D.measureText(t)}drawRectangle(t,e){var o,i,n,r,a,s;p("rect",{x:parseInt(t.x)+m/2,y:parseInt(t.y)+m/2,width:parseInt((o=t.w)!=null?o:t.measuredW)-m,height:parseInt((i=t.h)!=null?i:t.measuredH)-m,rx:L,fill:this.parseColor((n=t.properties)==null?void 0:n.color,"255,255,255"),"fill-opacity":(a=(r=t.properties)==null?void 0:r.backgroundAlpha)!=null?a:1,stroke:this.parseColor((s=t.properties)==null?void 0:s.borderColor,"0,0,0"),"stroke-width":m},e)}addText(t,e,o,i){var n,r;let a=(n=t.properties.text)!=null?n:"",s=parseInt(t.x),l=parseInt(t.y),c=this.parseFontProperties(t),u=this.measureText(a,`${c.style} ${c.weight} ${c.size} ${c.family}`),f=i==="center"?s+((r=t.w)!=null?r:t.measuredW)/2-u.width/2:s,E=l+t.measuredH/2+u.actualBoundingBoxAscent/2,y=p("text",{x:f,y:E,fill:o,"font-style":c.style,"font-weight":c.weight,"font-size":c.size},e);if(!a.includes("{color:")){let g=p("tspan",{},y);g.textContent=a;return}a.split(/{color:|{color}/).forEach(g=>{if(g.includes("}")){let[h,b]=g.split("}");if(!h.startsWith("#")){let w=parseInt(h.slice(-1));h=isNaN(w)?x[h][0]:x[h][w]}let $=p("tspan",{fill:h},y);$.textContent=b}else{let h=p("tspan",{},y);h.textContent=g}})}TextArea(t,e){this.drawRectangle(t,e)}Canvas(t,e){this.drawRectangle(t,e)}Label(t,e){var o;this.addText(t,e,this.parseColor((o=t.properties)==null?void 0:o.color,"0,0,0"),"left")}TextInput(t,e){var o;this.drawRectangle(t,e),this.addText(t,e,this.parseColor((o=t.properties)==null?void 0:o.textColor,"0,0,0"),"center")}Arrow(t,e){var o,i,n;let r=parseInt(t.x),a=parseInt(t.y),{p0:s,p1:l,p2:c}=t.properties,u;((o=t.properties)==null?void 0:o.stroke)==="dotted"?u="0.8 12":((i=t.properties)==null?void 0:i.stroke)==="dashed"&&(u="28 46");let f={x:(c.x-s.x)*l.x,y:(c.y-s.y)*l.x};p("path",{d:`M${r+s.x} ${a+s.y}Q${r+s.x+f.x+f.y*l.y*3.6} ${a+s.y+f.y+-f.x*l.y*3.6} ${r+c.x} ${a+c.y}`,fill:"none",stroke:this.parseColor((n=t.properties)==null?void 0:n.color,"0,0,0"),"stroke-width":D,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":u},e)}Icon(t,e){var o;let i=parseInt(t.x),n=parseInt(t.y),r=10;p("circle",{cx:i+r,cy:n+r,r,fill:this.parseColor((o=t.properties)==null?void 0:o.color,"0,0,0")},e),t.properties.icon.ID==="check-circle"&&p("path",{d:`M${i+4.5} ${n+r}L${i+8.5} ${n+r+4} ${i+15} ${n+r-2.5}`,fill:"none",stroke:"#fff","stroke-width":3.5,"stroke-linecap":"round","stroke-linejoin":"round"},e)}HRule(t,e){var o,i,n,r;let a=parseInt(t.x),s=parseInt(t.y),l;((o=t.properties)==null?void 0:o.stroke)==="dotted"?l="0.8, 8":((i=t.properties)==null?void 0:i.stroke)==="dashed"&&(l="18, 30"),p("path",{d:`M${a} ${s}L${a+parseInt((n=t.w)!=null?n:t.measuredW)} ${s}`,fill:"none",stroke:this.parseColor((r=t.properties)==null?void 0:r.color,"0,0,0"),"stroke-width":m,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":l},e)}__group__(t,e){var o;let i=(o=t?.properties)==null?void 0:o.controlName,n=T(i),r=localStorage.getItem(n)==="done",a=p("g",{...i?{class:`clickable-group ${r?"done":""}`,"data-group-id":i}:{}},e);t.children.controls.control.sort((s,l)=>s.zOrder-l.zOrder).forEach(s=>{s.x=parseInt(s.x,10)+parseInt(t.x,10),s.y=parseInt(s.y,10)+parseInt(t.y,10),this.render(s,a)})}};async function C(d,t={}){if(t={padding:5,fontFamily:"balsamiq",fontURL:"https://fonts.gstatic.com/s/balsamiqsans/v3/P5sEzZiAbNrN8SB3lQQX7Pncwd4XIA.woff2",...t},t.fontURL){let l=new FontFace(t.fontFamily,`url(${t.fontURL})`);await l.load(),document.fonts.add&&document.fonts.add(l)}let e=d.mockup,o=e.measuredW-e.mockupW-t.padding,i=e.measuredH-e.mockupH-t.padding,n=parseInt(e.mockupW)+t.padding*2,r=parseInt(e.mockupH)+t.padding*2,a=p("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:`${o} ${i} ${n} ${r}`,style:"font-family: balsamiq"}),s=new k(a,t.fontFamily);return e.controls.control.sort((l,c)=>l.zOrder-c.zOrder).forEach(l=>{s.render(l,a)}),a}var I=class{constructor(){this.overlayId="topic-overlay",this.contentId="topic-content",this.loaderId="topic-loader",this.topicBodyId="topic-body",this.topicActionsId="topic-actions",this.markTopicDoneId="mark-topic-done",this.closeTopicId="close-topic",this.activeRoadmapId=null,this.activeTopicId=null,this.handleTopicClick=this.handleTopicClick.bind(this),this.close=this.close.bind(this),this.resetDOM=this.resetDOM.bind(this),this.populate=this.populate.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.markAsDone=this.markAsDone.bind(this),this.queryRoadmapElementsByTopicId=this.queryRoadmapElementsByTopicId.bind(this),this.init=this.init.bind(this)}get loaderEl(){return document.getElementById(this.loaderId)}get markTopicDoneEl(){return document.getElementById(this.markTopicDoneId)}get topicActionsEl(){return document.getElementById(this.topicActionsId)}get contentEl(){return document.getElementById(this.contentId)}get overlayEl(){return document.getElementById(this.overlayId)}resetDOM(t=!1){t?this.overlayEl.classList.add("hidden"):this.overlayEl.classList.remove("hidden"),this.loaderEl.classList.remove("hidden"),this.topicActionsEl.classList.add("hidden"),this.contentEl.replaceChildren("")}close(){this.resetDOM(!0),this.activeRoadmapId=null,this.activeTopicId=null}populate(t){this.contentEl.replaceChildren(t),this.loaderEl.classList.add("hidden"),this.topicActionsEl.classList.remove("hidden")}fetchTopicHtml(t,e){let o=e.replace(/^\d+-/,"").replaceAll(/:/g,"/"),i=`/${t}/${o}/`;return fetch(i).then(n=>n.text()).then(n=>new DOMParser().parseFromString(n,"text/html").getElementById("main-content"))}handleTopicClick(t){let{roadmapId:e,topicId:o}=t.detail;if(!o||!e){console.log("Missing topic or roadmap: ",t.detail);return}if(this.activeRoadmapId=e,this.activeTopicId=o,/^ext_link/.test(o)){window.open(`https://${o.replace("ext_link:","")}`);return}this.resetDOM(),this.fetchTopicHtml(e,o).then(i=>{this.populate(i)}).catch(i=>{console.error(i),this.populate("Error loading the content!")})}queryRoadmapElementsByTopicId(t){let e=document.querySelectorAll(`[data-group-id$="-${t}"]`),o=[];return e.forEach(i=>{let n=i?.dataset?.groupId||"";new RegExp(`^\\d+-${t}$`).test(n)&&o.push(i)}),o}markAsDone(t){let e=t.replace(/^\d+-/,"");localStorage.setItem(e,"done"),this.queryRoadmapElementsByTopicId(e).forEach(o=>{o?.classList?.add("done")})}handleOverlayClick(t){if(!t.target.closest(`#${this.topicBodyId}`)){this.close();return}t.target.id===this.markTopicDoneId&&(this.markAsDone(this.activeTopicId),this.close()),(t.target.id===this.closeTopicId||t.target.closest(`#${this.closeTopicId}`))&&this.close()}init(){window.addEventListener("topic.click",this.handleTopicClick),window.addEventListener("click",this.handleOverlayClick),window.addEventListener("keydown",t=>{t.key.toLowerCase()==="escape"&&this.close()})}};var v=class{constructor(t){this.roadmapId=t.roadmapId,this.jsonUrl=t.jsonUrl,this.containerId="roadmap-svg",this.init=this.init.bind(this),this.onDOMLoaded=this.onDOMLoaded.bind(this),this.fetchRoadmapSvg=this.fetchRoadmapSvg.bind(this),this.handleRoadmapClick=this.handleRoadmapClick.bind(this)}fetchRoadmapSvg(t){return t?fetch(t).then(function(e){return e.json()}).then(function(e){return C(e,{fontURL:"/assets/fonts/balsamiq.woff2"})}):(console.error("jsonUrl not defined in frontmatter"),null)}onDOMLoaded(){this.fetchRoadmapSvg(this.jsonUrl).then(t=>{document.getElementById(this.containerId).replaceChildren(t)}).catch(console.error)}handleRoadmapClick(t){let e=t.target.closest("g")||{},o=e.dataset?e.dataset.groupId:"";!o||(t.stopImmediatePropagation(),window.dispatchEvent(new CustomEvent("topic.click",{detail:{topicId:o,roadmapId:this.roadmapId}})))}init(){window.addEventListener("DOMContentLoaded",this.onDOMLoaded),window.addEventListener("click",this.handleRoadmapClick)}};window.initRoadmap=function(d){new v(d).init(),new I().init()};})();
//# sourceMappingURL=roadmap.js.map
