import{h as d,p as b}from"./hooks.module.ee390651.js";import{S as I}from"./spinner.164b1eeb.js";import{a as S,T as P}from"./jwt.5024b243.js";import{o as i}from"./jsxRuntime.module.760e3403.js";import{_}from"./preact.module.e54f245b.js";const R="/_astro/github.43963666.svg",a="githubRedirectAt",m="githubLastPage";function H(U){const[r,t]=d(!1),[c,n]=d(""),h=r?I:R;return b(()=>{const e=new URLSearchParams(window.location.search),u=e.get("code"),f=e.get("state"),w=e.get("provider");!u||!f||w!=="github"||(t(!0),fetch(`${{}.PUBLIC_API_URL}/v1-github-callback${window.location.search}`,{method:"GET",credentials:"include"}).then(o=>o.json()).then(o=>{if(!o.token)n("Something went wrong. Please try again later."),t(!1);else{let s="/";const l=localStorage.getItem(a),g=localStorage.getItem(m);if(l&&g){const p=parseInt(l,10);Date.now()-p<30*1e3&&(s=g)}localStorage.removeItem(a),S.set(P,o.token),window.location.href=s}}).catch(o=>{n("Something went wrong. Please try again later."),t(!1)}))},[]),i(_,{children:[i("button",{class:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:r,onClick:()=>{t(!0),fetch(`${{}.PUBLIC_API_URL}/v1-github-login`,{credentials:"include",redirect:"follow"}).then(e=>e.json()).then(e=>{e.loginUrl?(["/login","/signup"].includes(window.location.pathname)||(localStorage.setItem(a,Date.now().toString()),localStorage.setItem(m,window.location.pathname)),window.location.href=e.loginUrl):(n("Something went wrong. Please try again later."),t(!1))}).catch(e=>{n("Something went wrong. Please try again later."),t(!1)})},children:[i("img",{src:h,alt:"GitHub",class:`h-[18px] w-[18px] ${r?"animate-spin":""}`}),"Continue with GitHub"]}),c&&i("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:c})]})}export{H as GitHubButton};
