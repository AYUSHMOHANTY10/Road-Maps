import{h as d,p as S}from"./hooks.module.ee390651.js";import{a as G,T as I}from"./jwt.5024b243.js";import{S as b}from"./spinner.164b1eeb.js";import{o as r}from"./jsxRuntime.module.760e3403.js";import{_ as E}from"./preact.module.e54f245b.js";const P="/_astro/google.7060ed7f.svg",a="googleRedirectAt",m="googleLastPage";function y(x){const[i,o]=d(!1),[l,n]=d(""),f=i?b:P;return S(()=>{const e=new URLSearchParams(window.location.search),h=e.get("code"),w=e.get("state"),p=e.get("provider");!h||!w||p!=="google"||(o(!0),fetch(`https://api.roadmap.sh/v1-google-callback${window.location.search}`,{method:"GET",credentials:"include"}).then(t=>t.json()).then(t=>{if(!t.token)n("Something went wrong. Please try again later."),o(!1);else{let s="/";const c=localStorage.getItem(a),g=localStorage.getItem(m);if(c&&g){const u=parseInt(c,10);Date.now()-u<30*1e3&&(s=g)}localStorage.removeItem(a),G.set(I,t.token),window.location.href=s}}).catch(t=>{n("Something went wrong. Please try again later."),o(!1)}))},[]),r(E,{children:[r("button",{class:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:i,onClick:()=>{o(!0),fetch("https://api.roadmap.sh/v1-google-login",{credentials:"include",redirect:"follow"}).then(e=>e.json()).then(e=>{e.loginUrl?(["/login","/signup"].includes(window.location.pathname)||(localStorage.setItem(a,Date.now().toString()),localStorage.setItem(m,window.location.pathname)),window.location.href=e.loginUrl):(n("Something went wrong. Please try again later."),o(!1))}).catch(e=>{n("Something went wrong. Please try again later."),o(!1)})},children:[r("img",{src:f,alt:"Google",class:`h-[18px] w-[18px] ${i?"animate-spin":""}`}),"Continue with Google"]}),l&&r("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:l})]})}export{y as GoogleButton};
