import{a as b}from"./js.cookie.cf83ad76.js";import{h as l}from"./hooks.module.da6d90ff.js";import{T as v}from"./constants.007bcfeb.js";import{S as x}from"./Spinner.a1a765f7.js";import{o as e}from"./jsxRuntime.module.760e3403.js";import{_ as N}from"./preact.module.e54f245b.js";const P=()=>{const[s,c]=l(""),[m,d]=l(""),[u,i]=l(!1),[a,n]=l(null),g=async t=>{t.preventDefault(),i(!0),n(null);const r=localStorage.getItem("verification-email-sent-at");if(r){const p=new Date;if(Number(r)>p.getTime())return i(!1),c(""),d(""),n({type:"error",message:"Please wait before sending another verification email."})}const o=await(await fetch("http://localhost:8080/v1-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:m})})).json();if(o.type==="user_not_verified")return i(!1),n({type:"verification",message:"Your account is not verified. Please click the verification link in your email. Or resend verification email."});o.token?(b.set(v,o.token),window.location.href="/"):n({type:"error",message:o.message}),i(!1)},y=async()=>{i(!0);const t=localStorage.getItem("verification-email-sent-at");if(t){const w=new Date;if(Number(t)>w.getTime())return i(!1),n({type:"error",message:"Please wait before sending another verification email."})}const r=await fetch("http://localhost:8080/v1-send-verification-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),f=await r.json();if(!r.ok)return n({type:"error",message:f.message});c(""),d(""),n({type:"success",message:"Verification instructions have been sent to your email."});const o=new Date,h=o.getTime()+5e3;o.setTime(h),localStorage.setItem("verification-email-sent-at",o.getTime().toString()),i(!1)};return e("form",{className:"w-full",onSubmit:g,children:[e("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full appearance-none rounded-lg border border-gray-300 px-3 py-2 shadow-sm  outline-none transition duration-150 ease-in-out placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"john@example.com",value:s,onInput:t=>c(String(t.target.value))}),e("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"mt-2 block w-full appearance-none rounded-lg border border-gray-300 px-3 py-2 shadow-sm  outline-none transition duration-150 ease-in-out placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Enter you password",value:m,onInput:t=>d(String(t.target.value))}),a&&e(N,{children:a.type==="verification"?e("div",{className:"mt-2 rounded-lg bg-yellow-100 p-2 text-sm text-yellow-800",children:["Your account is not verified. Please click the verification link in your email. Or"," ",e("button",{type:"button",className:"font-semibold text-yellow-900 underline hover:text-yellow-800 hover:no-underline",onClick:y,children:"resend verification email."})]}):e("div",{className:`mt-2 rounded-lg p-2 ${a.type==="success"&&"bg-green-100 text-green-800"} ${a.type==="error"&&"bg-red-100 text-red-800"} ${a.type==="warning"&&"bg-yellow-100 text-yellow-800"}`,children:a.message})}),e("button",{disabled:u||!s||!m,type:"submit",className:"mt-3 inline-flex h-10 w-full items-center justify-center rounded-lg border border-slate-300 bg-black p-2 text-sm font-medium text-white outline-none transition duration-150 ease-in-out focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:opacity-60",children:u?e(x,{className:"text-white"}):"Continue"})]})};export{P as default};
